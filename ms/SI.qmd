---
fontsize: 12pt
geometry: margin=1in
link-citations: yes
# csl: templates/ecology-letters.csl
# bibliography: templates/seedling.bib
crossref:
  fig-title: Fig.
  fig-prefix: Fig.
  eq-prefix: Eq.
format:
  html:
    theme: spacelab #readable #sandstone #spacelab #flatly
    toc: true
    toc-depth: 2
    toc-title: Contents
    self-contained: true
    smooth-scroll: true
    highlight-style: github
  docx:
    toc: false
    number-sections: false
    highlight-style: github
    html-math-method: katex
  pdf:
    toc: false
    keep-tex: true
    pdf-engine: pdflatex
    include-in-header:
      text: |
        \usepackage{xr}
        \usepackage[default]{sourcesanspro}
        \usepackage{sourcecodepro}
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```



```{r}
library(tidyverse)
library(patchwork)
library(here)
library(kableExtra)
```

```{r}
source(here("R", "stan.R"))
```

```{r, include=FALSE}
dry_gamma <- read_csv(here("data", "dry_gamma.csv"))
dry_gamma |>
  filter(q2_5 * q97_5 > 0)
dry_gamma |>
  filter(trait_name == "intercept")
```

# Table S1

Posterior means and 95% credible intervals (CIs) of the effects of species-level predcitors on indivdiual-level precitors ($\gamma$) in the dry seasons.
Bold values are significantly different from zero (the 95% CIs do not include zero).
ConS/HetS: conspecific/heterospecific seedling density,
ConT/HetT: conspecific/heterospecific tree density (scaled by 0.27),
LDMC: leaf dry matter content,
SDMC: stem dry matter content,
Chl: chlorophyll content,
$\delta$C~13~: stable carbon isotope composition,
C: carbon concentration,
N: nitrogen concentration,
$\pi$~tlp~: leaf turgor loss point,
LA: leaf area,
SLA: specific leaf area,
LT: leaf thickness.

```{r, include=FALSE}
gen_si_tab <- function(data) {
  data |>
    mutate(pred_name = case_when(
      pred_name == "int" ~ "Intercept",
      pred_name == "logh_scaled" ~ "ln Height",
      pred_name == "cons_scaled" ~ "ConS",
      pred_name == "cona_scaled_c" ~ "ConT",
      pred_name == "hets_scaled" ~ "HetS",
      pred_name == "heta_scaled_c" ~ "HetT",
      pred_name == "rain_scaled" ~ "Rainfall",
      pred_name == "cons_rain" ~ "ConS $\\times$ Rainfall",
      pred_name == "cona_rain" ~ "ConT $\\times$ Rainfall",
      pred_name == "hets_rain" ~ "HetS $\\times$ Rainfall",
      pred_name == "heta_rain" ~ "HetT $\\times$ Rainfall"
    )) |>
    mutate(trait_name = case_when(
      trait_name == "intercept" ~ "Intercept",
      trait_name == "ldmc" ~ "LDMC",
      trait_name == "sdmc" ~ "SDMC",
      trait_name == "chl" ~ "Chl",
      trait_name == "c13" ~ "$\\delta \\mathrm{C_{13}}$",
      trait_name == "c_mass" ~ "C",
      trait_name == "n_mass" ~ "N",
      trait_name == "tlp" ~ "$\\pi_\\mathrm{{tlp}}$",
      trait_name == "log_la" ~ "ln LA",
      trait_name == "log_sla" ~ "ln SLA",
      trait_name == "log_lt" ~ "ln LT")) |>
    mutate(mean_ = round(mean_, 3)) |>
    mutate(mean_ = cell_spec(mean_, bold= ifelse(q2_5 * q97_5 > 0, TRUE,FALSE))) |>
    mutate(q2_5 = round(q2_5, 3)) |>
    mutate(q5 = round(q5, 3)) |>
    mutate(q95 = round(q95, 3)) |>
    mutate(q97_5 = round(q97_5, 3)) |>
    mutate(`90\\% CI` = paste0("[", q5, ", ", q95, "]")) |>
    mutate(`95\\% CI` = paste0("[", q2_5, ", ", q97_5, "]")) |>
    mutate(`95\\% CI` = cell_spec(`95\\% CI`, bold= ifelse(q2_5 * q97_5 > 0, TRUE,FALSE))) |>
    mutate(para = paste0(
      "$\\gamma_{",
      str_split_fixed(data$para, "_" ,3)[,2],
      ",",
      str_split_fixed(data$para, "_" ,3)[,3],
      "}$")) |>
    rename(Parameter = para) |>
    rename(Mean = mean_) |>
    rename(`Lower 2.5\\% CI` = q2_5) |>
    rename(`Lower 5\\% CI` = q5) |>
    rename(`Upper 95\\% CI` = q95) |>
    rename(`Upper 97.5\\% CI` = q97_5) |>
    rename(`Individual-level predictor` = pred_name) |>
    rename(`Species-level predictor` = trait_name) |>
    # kable(format = "latex") #|>
    dplyr::select(Parameter, Mean,
    # `Lower 2.5\\% CI`#,
    #`90\\% CI`,
    `95\\% CI`,
    `Individual-level predictor`,
    `Species-level predictor`
    ) |>
    kbl(booktabs = TRUE, escape = FALSE, format = "latex", longtable = TRUE) |>
    kable_styling(latex_options = c("striped", "scale_down", "HOLD_position", "repeat_header"))
    #kable_styling()
}
```

```{r}
gen_si_tab(dry_gamma)
```

\newpage

```{r, include=FALSE}
s_table_full <- captioner::captioner(prefix = "Table S", auto_space = FALSE)
s_table <- pryr::partial(s_table_full, display = "cite", caption = "blank")
```

# Table S2

Posterior means and 95% credible intervals (CIs) of the effects of species-level predcitors on indivdiual-level precitors ($\gamma$) in the rainy seasons.
Densities of conspecific (ConT) and heterospecific (HetT) trees are scaled by 0.24.
Other details as for Table S1.

```{r, include=FALSE}
wet_gamma <- read_csv(here("data", "wet_gamma.csv"))
wet_gamma |>
  filter(q2_5 * q97_5 > 0)
wet_gamma |>
  filter(trait_name == "intercept")
```
```{r}
gen_si_tab(wet_gamma)
```
